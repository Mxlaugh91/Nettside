<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Test</title>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Location Service Test</h1>
    <div id="output"></div>
    <button onclick="testLocations()">Test Load Locations</button>

    <script defer src="js/core/firebase-init.js"></script>
    <script defer src="js/core/logger.js"></script>
    <script defer src="js/services/locationService.js"></script>
      <script>
        let testResults = [];
        
        window.addEventListener('load', function() {
            console.log('Page loaded');
            setTimeout(() => {
                runTests();
            }, 2000); // Wait 2 seconds for all scripts to load
        });

        function logTest(test, result) {
            testResults.push(`${test}: ${result}`);
            updateOutput();
        }

        function updateOutput() {
            const output = document.getElementById('output');
            output.innerHTML = '<h3>Test Results:</h3><pre>' + testResults.join('\n') + '</pre>';
        }

        function runTests() {
            logTest('Firebase available', typeof firebase !== 'undefined');
            logTest('firestoreDB available', typeof firestoreDB !== 'undefined');
            logTest('AppLogger available', typeof AppLogger !== 'undefined');
            logTest('AppServices available', typeof AppServices !== 'undefined');
            logTest('AppServices.locations available', typeof AppServices !== 'undefined' && typeof AppServices.locations !== 'undefined');
            
            if (typeof AppServices !== 'undefined' && AppServices.locations) {
                logTest('AppServices.locations methods', Object.keys(AppServices.locations).join(', '));
                logTest('getActiveLocations method', typeof AppServices.locations.getActiveLocations);
            }
        }

        async function testLocations() {
            const output = document.getElementById('output');
            
            try {
                console.log('Testing location service...');
                
                if (!AppServices || !AppServices.locations) {
                    throw new Error('AppServices.locations not available');
                }
                
                if (typeof AppServices.locations.getActiveLocations !== 'function') {
                    throw new Error('getActiveLocations is not a function');
                }
                
                logTest('Calling getActiveLocations', 'Starting...');
                const locations = await AppServices.locations.getActiveLocations();
                console.log('Locations result:', locations);
                
                logTest('getActiveLocations result', `Success! Found ${locations.length} locations`);
                
                if (locations.length > 0) {
                    logTest('First location', JSON.stringify(locations[0], null, 2));
                }
                
            } catch (error) {
                console.error('Error:', error);
                logTest('Error occurred', error.message);
                logTest('Error stack', error.stack);
            }
        }
    </script>
</body>
</html>
